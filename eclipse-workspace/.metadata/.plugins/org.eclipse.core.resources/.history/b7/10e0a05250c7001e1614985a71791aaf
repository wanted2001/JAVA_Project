package ezen_messenger1;

import java.io.BufferedReader;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.util.Scanner;

public class Login{

	public void checkLogin(Scanner sc) throws IOException{
		System.out.println("아이디를 입력해주세요. ");
		String id = sc.next();
		if(checkId(id)){
			System.out.println("비밀번호를 입력해주세요. ");
			String PassWord = sc.next();
			while(!checkPassWord(PassWord)){
				System.out.println("비밀번호 에러");
				System.out.println("다시 입력해주세요. ");
				PassWord = sc.next();
			}
			System.out.println("로그인에 성공하였습니다.");
			tmpPath(id);
			loginPass(sc);
			return;
		}else{
			System.out.println("없는 아이디 입니다. ");
			checkLogin(sc);
		}
	}
	public void loginPass(Scanner sc) throws IOException{
		System.out.println("1. 친구 | 2. 쪽지함 | 3. 로그아웃");
		int menu = sc.nextInt();
		FriendsManager f = new FriendsManager();
		MailBox m = new MailBox();
		MessengerMain mm = new MessengerMain();
		do{
			switch(menu){
			case 1: f.friendsMain(sc);
					break;
			case 2: m.mailBoxMain(sc);
					break;
			case 3: mm.main(null);
				break;
			default : System.out.println("잘못 입력하셨습니다. ");
			}
		}while(menu != 3);
	}
	public boolean checkId(String a) throws IOException{
		BufferedReader br = new BufferedReader(new FileReader("C:\\Messenger\\memberList.txt"));
		br.close();
		while(true){
			String line = br.readLine();
			if(line == null) {
				break;
			}
			String Id = line.substring(0, line.indexOf(" "));
			if(Id.equals(a)){
				return true;
			}
		}
		return false;
	}
	public boolean checkPassWord(String a) throws IOException{
		BufferedReader br = new BufferedReader(new FileReader("C:\\Messenger\\memberList.txt"));
		while(true){
			String line = br.readLine();
			if(line == null)
				break;
			String PassWord = line.substring(line.indexOf(" ") + 1);
			if(PassWord.equals(a)) {
				return true;
			}
		}
		br.close();
		return false;
	}
	public void tmpPath(String a) throws IOException{
		FileWriter fw = new FileWriter("C:\\Messenger\\tmp.txt");
		fw.write(a);
		fw.close();
	}
}